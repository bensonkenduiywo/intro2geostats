<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Geostatistical prediction/prediction</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Geostatistics in R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-home"></span>
     
    Home
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ex1_intro2R.html">Manipulating data in R Exercise</a>
    </li>
    <li>
      <a href="ex1_intro2R_answers.html">Manipulating data in R Solutions</a>
    </li>
    <li>
      <a href="lesson1.html">Exploratory data analysis</a>
    </li>
    <li>
      <a href="lesson2.html">Spatial prediction</a>
    </li>
    <li>
      <a href="lesson3.html">Non-geostatistical spatial prediction</a>
    </li>
    <li>
      <a href="lesson4.html">Geostatistical spatial prediction</a>
    </li>
    <li>
      <a href="lesson5.html">Model-Based Geostatistics</a>
    </li>
    <li>
      <a href="lesson6.html">Spatial geo-regression</a>
    </li>
    <li>
      <a href="lesson7.html">Analyzing spatial trend</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="mailto:bensonkemboi@gmail.com">
    <span class="fas fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/bensonkenduiywo">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/bensonkenduiywo">
    <span class="fab fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://www.linkedin.com/in/benson-kenduiywo-1a218137">
    <span class="fab fa-linkedin fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Geostatistical prediction/prediction</h1>

</div>


<p>Geostatistical interpolation differs from <a href="lesson1.html">non-geostatistical interpolation</a> approaches in that it assumes the data point values represent a sample from some underlying true population. By analyzing the sample it is possible to derive a general model that describes how the sample values vary with distance (and optionally, direction). A generalized model used conventional to describe spatial correlation of phenomena with respect to distance and direction is term as the <strong>Variogram</strong>. The variogram model may then be used to interpolate, or predict (a process called kriging), values at unsampled locations, in much the same way as with deterministic interpolation. If the samples meet various additional conditions it may also be possible to provide estimated confidence intervals for these predictions. Geostatistical interpolation methods attempt to address questions like:</p>
<ul>
<li>how many points are needed to compute the local average?</li>
<li>what size, orientation and shape of neighborhood should be chosen?</li>
<li>what model and weights should be used to compute the local average?</li>
<li>what errors (uncertainties) are associated with interpolated values?</li>
</ul>
<div id="estimating-spatial-correlation-the-variogram" class="section level2">
<h2>Estimating Spatial correlation: the Variogram</h2>
<p>In geostatistics, spatial correlation has traditionally been modelled by a <strong>variogram</strong>. The variogram (semi-variogram) explains the degree to which nearby locations have similar values using <em>semi-variance</em>.</p>
<p>In standard statistical problems, correlation can be estimated from a scatterplot, when several data pairs {a, b} are available. The spatial correlation between two observations of a variable <em>z(x)</em> at locations <span class="math inline">\(x\)</span> and <span class="math inline">\(x+h\)</span>, where <em>h</em> is the separating distance (lag), cannot be estimated, as only a single pair is available i.e. correlations can not be computed from two variables with a single observations. Geostatistics adopt <strong>stationarity</strong> assumption in order to compute spatial correlation. Stationarity underpins the practicality of geostatistics; it is assumption enables us to treat data as though they have the same degree of variation over a region of interest <a href="https://www.springer.com/gp/book/9783319158648">(Oliver &amp; Webster, 2015)</a>. A commonly used form of stationarity is termed as <strong>intrinsic stationarity</strong>, which assumes that the process that generated the samples is a random function <em>Z(x)</em> composed of a mean and residual</p>
<p><span class="math display">\[Z(x) = m + e(x),\]</span> with a constant mean</p>
<p><span class="math display">\[E(Z(x)) = m\]</span> and a variogram <span class="math inline">\(\gamma(h)\)</span> defined as</p>
<p><span class="math display">\[\hat{\gamma}(h) =\frac{1}{2N}\sum_{i=1}^{N}\left\{Z(\textbf{x}_i+h)-Z(\textbf{x}_i)\right\}^2 \]</span> where <em>N</em> is the number of pair points seprated by lag <em>h</em> used to estimate <span class="math inline">\(\hat{\gamma}(h)\)</span>. This is also known as the <em>variogram cloud</em>, which shows the semivariances between all point pairs.</p>
<p>Load the carbon data</p>
<pre class="r"><code>rm(list=ls(all=TRUE))
unlink(&quot;.RData&quot;)
library(rgdal)
d &lt;- readOGR(&quot;./data/soil_data_CIAT.shp&quot;)
head(d, n=3)</code></pre>
<p>How many point pairs are there in our data given the formula as <span class="math display">\[N= [n · (n − 1)]/2\]</span></p>
<pre class="r"><code>(dim(d)[1] * (dim(d)[1] - 1))/2</code></pre>
<pre><code>## [1] 19900</code></pre>
</div>
<div id="variogram-cloud" class="section level2">
<h2>Variogram cloud</h2>
<p>Let us plot a variogram cloud of Clay content. A variogram cloud is a scatterplot of data pairs, in which the semivariance is plotted against interpoint distance.</p>
<pre class="r"><code>library(gstat)
vc &lt;- variogram(d$Clay~1, data=d, cloud = T)
head(vc, n=3)</code></pre>
<pre><code>##       dist     gamma dir.hor dir.ver   id left right
## 1 1274.755  32.25350       0       0 var1    2     1
## 2 5505.679 292.14900       0       0 var1    4     2
## 3 1500.000  36.33051       0       0 var1    4     3</code></pre>
<pre class="r"><code>plot(vc, main = &quot;Variogram cloud of Clay&quot;, xlab = &quot;lag in meters&quot;)</code></pre>
<p><img src="lesson4_files/figure-html/v3-1.png" width="672" /></p>
<p>Note that the formula <code>d$Clay~1</code> indicates the form of the spatial dependence. The right-hand side 1 means to model the left-hand side <code>d$Clay</code> only as local spatial dependence, i.e. without any trend or other explanatory factors.</p>
</div>
<div id="variogram-map" class="section level2">
<h2>Variogram map</h2>
<p>We can also show the variogram map. The maps provide another means of looking at directional dependence in semivariograms. The map is centered around (0, 0), as <em>h</em> is geographical distance rather than geographical location. Cutoff and width correspond to some extent to map extent and cell size; the semivariance map is point symmetric around (0, 0), as <span class="math inline">\(\gamma(h) = \gamma(−h)\)</span>. We will set a threshold of 5 to ensure that only semivariogram map values based on at least 5 point pairs are shown, removing too noisy estimation.</p>
<pre class="r"><code>v.map = variogram(Clay~1, d, cutoff = 1500, width = 100, map = TRUE)
plot(v.map, threshold = 5)</code></pre>
<p><img src="lesson4_files/figure-html/v4-1.png" width="672" /></p>
<p>From the map we can see that there is there si strong spatial depency in clay content in the direction NE to SW.</p>
</div>
<div id="empirical-variogram" class="section level2">
<h2>Empirical variogram</h2>
<p>This variogram can be plotted as semi-variance <span class="math inline">\(\gamma(h)\)</span> (the squared difference of a certain property between locations) against average separation distance (<em>h</em>) along with the number of points that contributed to each estimate. Empirical here is used to refer to an experimental/sample variogram i.e. based on data test.</p>
<pre class="r"><code>v &lt;- variogram(Clay~1, data=d)
plot(v, plot.numbers=T,pch=3)</code></pre>
<p><img src="lesson4_files/figure-html/v5-1.png" width="672" /></p>
</div>
<div id="main-properties-of-variogram" class="section level2">
<h2>Main properties of Variogram</h2>
<p>Some key properties of the variogram amongst others include:</p>
<ol style="list-style-type: decimal">
<li>Range: the critical distance beyond which there is no further correlation in the variogram,</li>
<li>Sill: is the maximum semi-variance. It represents variability in the absence of spatial dependence, and</li>
<li>Nugget: is the semi-variance as the separation approaches zero. It represents variability at a point that cant be explained by spatial structure.</li>
</ol>
<p>Let us define these properties using our variogram.</p>
<pre class="r"><code>nugget &lt;- 38
cat(&quot;Nugget is &quot;, nugget)</code></pre>
<pre><code>## Nugget is  38</code></pre>
<pre class="r"><code>sill &lt;- v$gamma[v$np==671]
cat(&quot;Sill is &quot;, sill)</code></pre>
<pre><code>## Sill is  70.58303</code></pre>
<pre class="r"><code>range &lt;- v$dist[v$np==671]
cat(&quot;range is &quot;, range, &quot; m&quot;)</code></pre>
<pre><code>## range is  2229.411  m</code></pre>
</div>
<div id="defining-variogram-bins" class="section level2">
<h2>Defining variogram bins</h2>
<p>Some notes:</p>
<ol style="list-style-type: decimal">
<li>Distance interval, specifying the centres. E.g. <span class="math inline">\((0, 100, 200, \dots)\)</span> means intervals of <span class="math inline">\([0,\dots,50]\)</span>, <span class="math inline">\([50, \dots, 150]\)</span>, . . .</li>
<li>All point pairs whose separation is in the interval are used to estimate <span class="math inline">\(\gamma(h)\)</span> for <em>h</em> as the interval centre</li>
<li>Narrow intervals: more resolution but fewer point pairs for each sample</li>
<li>Each bin should have &gt; 100 point pairs; &gt; 300 is much more reliable.</li>
</ol>
<p>So we can use a loop to evaluate different bin sizes.</p>
<pre class="r"><code>par(mfrow = c(2,3), oma = c(2,2,0,0), mar = c(3,3,0,0), mgp = c(1.5,0.5,0),xpd = NA)
for (bw in seq(20, 220, by = 40)) {
  v&lt;-variogram(Clay~1, d, width=bw)
  plot(v$dist, v$gamma, xlab=paste(&quot;bin width&quot;, bw))
  cat(bw, &quot; bin width has these np:&quot;, v$np) 
}</code></pre>
<p><img src="lesson4_files/figure-html/v6-1.png" width="672" /></p>
<p>We observe that if the intervals are short &amp; the bins narrow then there will be many estimates of (<em>h</em>), which can lead to a ”noisy” variogram because the semi-variances are calculated from few comparisons. In contrast, if the intervals are large and the bins wide then there might be too few estimates of the semi-variances to reveal the form of the variogram. The choice is thus a compromise; cannot be automated.</p>
</div>
<div id="variogram-modelling-and-fitting" class="section level2">
<h2>Variogram modelling and fitting</h2>
<p>In order to be able to define characteristics of the empirical variogram we parameterise it using different semi-variogram models. To do this authorized functions that are conditional negative semi-definite (positive definite) to the experimental values are used. There are a few principal features that the function must be able to represent <a href="https://onlinelibrary.wiley.com/doi/book/10.1002/9780470517277">(Webster and Oliver, 2007)</a>:</p>
<ol style="list-style-type: decimal">
<li>a monotonic increase with increasing lag distance from the ordinate of appropriate shape;</li>
<li>a constant maximum or asymptote, or sill;</li>
<li>a positive intercept on the ordinate, or nugget;</li>
<li>anisotropy.</li>
</ol>
<p>The variogram model allows us to:</p>
<ul>
<li>Infer the characteristics of the underlying process from the functional form and its parameters;</li>
<li>Compute the semi-variance between any point-pair, separated by any vector which is used in an optimal interpolator (kriging) to predict at unsampled locations. The kriging algorithm will need access to semi-variogram values for lag distances other than those used in the empirical semi-variogram.</li>
<li>More importantly, the semivariogram models used in the kriging process need to obey certain numerical properties (the 4 features stated before) in order for the kriging equations to be solvable</li>
</ul>
<p>The following are the existing variogram models in R.</p>
<pre class="r"><code>show.vgms(as.groups=F, models=c(&quot;Nug&quot;, &quot;Sph&quot;, &quot;Exp&quot;, &quot;Gau&quot;, &quot;Pow&quot;, &quot;Pen&quot;), plot=TRUE)</code></pre>
<p><img src="lesson4_files/figure-html/v7-1.png" width="672" /></p>
<p>To fit a variogram model on clay content data we need to Calculate the experimental variogram and display it first.</p>
<pre class="r"><code>v &lt;- variogram(Clay~1, d, cressie=TRUE); 
plot(v, plot.numbers=T)</code></pre>
<p><img src="lesson4_files/figure-html/v8-1.png" width="672" /></p>
<p>Now lets us fit a suitable by eye using earlier variogram properties and display the fit.</p>
<pre class="r"><code># Fit by eye, display fit
m1 &lt;- vgm(sill, &quot;Exp&quot;, range, nugget); 
plot(v, plot.numbers=T, model=m1)</code></pre>
<p><img src="lesson4_files/figure-html/v9-1.png" width="672" /></p>
<pre class="r"><code># Let gstat adjust the parameters automatically, display fit
m2 &lt;- fit.variogram(v, m1); 
cat(&quot;Parameters determined automatically are: &quot;)</code></pre>
<pre><code>## Parameters determined automatically are:</code></pre>
<pre class="r"><code>m2</code></pre>
<pre><code>##   model    psill    range
## 1   Nug 39.42727    0.000
## 2   Exp 41.82577 2660.205</code></pre>
<pre class="r"><code>plot(v, plot.numbers=T, model=m2)</code></pre>
<p><img src="lesson4_files/figure-html/v9-2.png" width="672" /></p>
<pre class="r"><code># Fix the nugget, fit only the sill of Exponential model
m2a &lt;- fit.variogram(v,m1,fit.sills=c(F,T),fit.range=F); 
if (attr(m2a, &quot;singular&quot;)) stop(&quot;singular fit&quot;)
cat(&quot;Parameters determined by eye are: &quot;)</code></pre>
<pre><code>## Parameters determined by eye are:</code></pre>
<pre class="r"><code>m2a</code></pre>
<pre><code>##   model   psill    range
## 1   Nug 38.0000    0.000
## 2   Exp 40.6034 2229.411</code></pre>
<p>The fitting method uses non-linear regression to fit the coefficients. For this, a weighted sum of square errors (SSE), let us check it. In this case, the eye estimation is comparable to the automatic on based on SSE outcome <span class="math inline">\(\dots\)</span>.</p>
<pre class="r"><code>cat(&quot;SSE of automatic fit &quot;, attr(m2, &quot;SSErr&quot;))</code></pre>
<pre><code>## SSE of automatic fit  0.0625947</code></pre>
<pre class="r"><code>cat(&quot;SSE of manual fit &quot;, attr(m2a, &quot;SSErr&quot;))</code></pre>
<pre><code>## SSE of manual fit  0.06389576</code></pre>
</div>
<div id="prediction-kriging" class="section level2">
<h2>Prediction: Kriging</h2>
<p>Now that we have modelled our variogram we can use it for prediction using Kriging. Kriging is used to interpolate a value <span class="math inline">\(Z(x_i + h)\)</span> of a random field <em>Z(x)</em> at unobserved location <span class="math inline">\(x_i + h\)</span>, using data from observed location <span class="math inline">\(x_i\)</span>. It allows variance to be non-constant, dependent on distance between points as modeled by the variogram <span class="math inline">\(\gamma(h)\)</span>. The kriging estimator is given by</p>
<p><span class="math display">\[Z(x_i + h) = \sum_{j=1}^N w_i(x_i + h)Z(x_i) \]</span> referred to as ordinary kriging. Now lets is create an empty grid to hold our predictions.</p>
<pre class="r"><code>library(raster)
grid &lt;-as.data.frame(spsample(d, type = &#39;regular&#39;, n = 10000))
names(grid)       &lt;- c(&quot;X&quot;, &quot;Y&quot;)
coordinates(grid) &lt;- c(&quot;X&quot;, &quot;Y&quot;)
gridded(grid)     &lt;- TRUE  # Create SpatialPixel object
fullgrid(grid)    &lt;- TRUE  # Create SpatialGrid object
# Add data&#39;s projection information to the empty grid
crs(grid) &lt;- crs(d)</code></pre>
<p>Get rid of duplicates and perform predictions using kriging and display output.</p>
<pre class="r"><code>newdata &lt;- remove.duplicates(d)
lz.ok &lt;- krige(Clay ~ 1, newdata, grid, m2a)</code></pre>
<pre><code>## [using ordinary kriging]</code></pre>
<pre class="r"><code>spplot(lz.ok[&quot;var1.pred&quot;])</code></pre>
<p><img src="lesson4_files/figure-html/k2-1.png" width="672" /></p>
<p>The output does not correspond to our area onf interest, so convert it to raster and clip to boundary.</p>
<pre class="r"><code>bdy &lt;- readOGR(&quot;./data/soil_boundary.shp&quot;)
r &lt;- raster(lz.ok)
rclip &lt;- mask(r, bdy)</code></pre>
<p>Now display kriging results output.</p>
<pre class="r"><code>pacman::p_load(tmap)
spplot(rclip, &quot;var1.pred&quot;, scales = list(draw = TRUE),
       sp.layout = list(&quot;sp.points&quot;, d, pch = 16, cex = 2, col = &quot;black&quot;))</code></pre>
<p><img src="lesson4_files/figure-html/k5-1.png" width="672" /></p>
<pre class="r"><code>tm_shape(rclip) + tm_raster(&quot;var1.pred&quot;, style = &quot;quantile&quot;, n = 100, palette = &quot;-Reds&quot;, legend.show = FALSE) +
tm_shape(bdy) + tm_borders(alpha=1, col=&quot;black&quot;) + 
tm_shape(d) + tm_bubbles(size = &quot;Clay&quot;, col = &quot;Clay&quot;, palette = &quot;-Purples&quot;, contrast=1, style = &quot;quantile&quot;, legend.size.show = FALSE, title.col = &quot;Clay&quot;) +
tm_layout(legend.position = c(&quot;left&quot;, &quot;top&quot;),  legend.text.size = 1.1, legend.title.size = 1.4, frame = FALSE, legend.bg.color = &quot;white&quot;, legend.bg.alpha = 0.5)</code></pre>
<p><img src="lesson4_files/figure-html/k5-2.png" width="672" /></p>
<p>Compare the output with that of kriging visually, what do you think?</p>
</div>
<div id="variance-and-confidence-interval-maps" class="section level2">
<h2>Variance and confidence interval maps</h2>
<p>The <code>lz.ok</code> object output from kiriging stores not just the interpolated values, but the variance values as well. These can be passed to the raster object for mapping.</p>
<pre class="r"><code>r   &lt;- raster(lz.ok, layer=&quot;var1.var&quot;)
r.m &lt;- mask(r, bdy)

tm_shape(r.m) + 
  tm_raster(n = 10, style = &quot;kmeans&quot;, palette = &quot;-Blues&quot;,
            title=&quot;Variance map \n(Clay [%])&quot;) +tm_shape(d) + tm_dots(size=0.2) +
  tm_legend(legend.outside=TRUE)</code></pre>
<p><img src="lesson4_files/figure-html/c1-1.png" width="672" /></p>
<p>Perhaps an easily interpretable map is the 95% confidence interval map which can be generated from the variance object (the map values should be interpreted as the percentage deviation from the estimated clay percentage amount).</p>
<pre class="r"><code>r   &lt;- sqrt(raster(lz.ok, layer=&quot;var1.var&quot;)) * 1.96
r.m &lt;- mask(r, bdy)

tm_shape(r.m) + 
  tm_raster(n = 10, style = &quot;kmeans&quot;, palette = &quot;-Blues&quot;,
            title=&quot;95% CI map \n(Clay [%])&quot;) +tm_shape(d) + tm_dots(size=0.2) +
  tm_legend(legend.outside=TRUE)</code></pre>
<p><img src="lesson4_files/figure-html/c2-1.png" width="672" /></p>
<p>Cross validation is useful in finding artefacts in data. However, results from it should be used with caution for confirmatory purposes: one needs to be careful not to conclude that a model is correct if cross validation does not lead to unexpected findings. It is for instance not good at finding what is not in the data <a href="https://www.springer.com/gp/book/9781461476177">(Bivand et al. 2013)</a>.</p>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Bivand, R. S., Pebesma, E. J., Gomez-Rubio, V., &amp; Pebesma, E. J. (2013). <a href="https://www.springer.com/gp/book/9781461476177"><em>Applied spatial data analysis with R</em></a>. 2nd Eds. New York: Springer.</p>
<p>Webster, R., &amp; Oliver, M. A. (2007). <a href="https://onlinelibrary.wiley.com/doi/book/10.1002/9780470517277"><em>Geostatistics for Environmental Scientists</em></a> (2nd ed.). West Sussex, England: John Wiley &amp; Sons Ltd.</p>
<p>De Smith, M. J., Goodchild, M. F., &amp; Longley, P. (2018). <a href="https://www.spatialanalysisonline.com/HTML/index.html"><em>Geospatial analysis: a comprehensive guide to principles, techniques and software tools</em></a>. Troubador publishing ltd.</p>
<p>Oliver, M. A., &amp; Webster, R. (2015). <a href="https://www.springer.com/gp/book/9783319158648"><em>Basic steps in geostatistics: the variogram and kriging</em></a> (1st ed., Vol. 106). Springer</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
